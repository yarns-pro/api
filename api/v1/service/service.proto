syntax = "proto3";

option go_package = "github.com/yarns-pro/api/pkg/go/v1/service";
option java_multiple_files = true;
option java_package = "pro.yarns.api.v1.service";
option java_outer_classname = "ServiceProto";

package pro.yarns.api.v1.service;

import "v1/entity/user.proto";
import "v1/entity/message.proto";
import "v1/entity/message_type.proto";

service YarnsApiV1 {
  rpc Register (RegisterRequest) returns (RegisterResponse);
  rpc GetUserById (GetUserByIdRequest) returns (GetUserByIdResponse);
  rpc SendMessage (SendMessageRequest) returns (SendMessageResponse);
  rpc CheckMessages (CheckMessagesRequest) returns (CheckMessagesResponse);
  rpc GetMessageById (GetMessageByIdRequest) returns (GetMessageByIdResponse);
  rpc ConfirmReceive (ConfirmReceiveRequest) returns (ConfirmReceiveResponse);
}

message RegisterRequest {
  bytes publicKey = 1;
}

message RegisterResponse {
  entity.User user = 1;
}

message GetUserByIdRequest {
  int64 userId = 1;
}

message GetUserByIdResponse {
  entity.User user = 1;
}

message SendMessageRequest {
  int64 to = 1;
  entity.MessageType type = 2;
  bytes encryptedMetadata = 3;
  bytes encryptedBody = 4;
}

message SendMessageResponse {
  int64 messageId = 1;
}

message CheckMessagesRequest {
  int64 lastMessageId = 1;
}

message CheckMessagesResponse {
  repeated entity.Message messages = 1;
}

message GetMessageByIdRequest {
  int64 messageId = 1;
}

message GetMessageByIdResponse {
  entity.Message message = 1;
}

message ConfirmReceiveRequest {
  repeated int64 messageIds = 1;
}

message ConfirmReceiveResponse {}